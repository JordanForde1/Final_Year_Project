<!-- Reference:https://docs.djangoproject.com/en/1.11/intro/ -->
{% load leaflet_tags %}
{% load mathfilters %}
{% load bootstrap3 %}
<head>
    <!-- Map in center of the screen -->
    {% leaflet_js %}
    {% leaflet_css %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>

</head>

<h1>{{ questions.question_text }}</h1>
<body>
<h3>Progress bars!</h3>
<div class="container" id="container">
    <strong> Yes and no votes!</strong><br />
        {% for choice in questions.choice_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div id="choice" class="progress-bar progress-bar-info" role="progressbar"  style="width:{{ choice.votes|div:view.kwargs.totalVotes|mul:"100"}}%">{{ choice.choice_text }} : {{ choice.votes|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Male and Female voters!</strong>
        {% for gender in questions.gender_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ gender.num|div:view.kwargs.totalVotes|mul:"100" }}%">{{ gender.gender_text }} : {{ gender.num|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Ages of voters!</strong>
        {% for age in questions.age_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ age.option|div:view.kwargs.totalVotes|mul:"100" }}%">{{ age.age_text }} : {{ age.option|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Education of voters!</strong>
        {% for education in questions.education_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ education.number|div:view.kwargs.totalVotes|mul:"100" }}%">{{ education.education_text }}: {{ education.number|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Religion of voters!</strong>
        {% for religion in questions.religion_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ religion.pick|div:view.kwargs.totalVotes|mul:"100" }}%">{{ religion.religion_text }}: {{ religion.pick|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Ethnicity of voters!</strong>
        {% for ethnicity in questions.ethnicity_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ ethnicity.racenum|div:view.kwargs.totalVotes|mul:"100" }}%">{{ ethnicity.ethnicity_text }}: {{ ethnicity.racenum|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Income of voters!</strong>
        {% for income in questions.income_set.all|dictsortreversed:"id" %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ income.amount|div:view.kwargs.totalVotes|mul:"100" }}%">{{ income.income_text }}: {{ income.amount|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%</div>
            </div>
        {% endfor %}
</div>
<br /><br />
<h3>Charts!</h3>
<div class="container">
    <div class="row">
            <strong> Yes or no vote pie chart!</strong>
            <canvas id="choiceChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Male and Female pie chart!</strong>
        <canvas id="genderChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Age bar chart!</strong>
        <canvas id="ageChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Education bar chart!</strong>
        <canvas id="educationChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Religion bar chart!</strong>
        <canvas id="religionChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Ethnicity bar chart!</strong>
        <canvas id="ethnicityChart" width="100" height="50"></canvas>
    </div>
</div>
<br />

<div class="container">
    <div class="row">
        <strong> Income bar chart!</strong>
        <canvas id="incomeChart" width="100" height="50"></canvas>
    </div>
</div>
<br />
<br />

<script>
        var dataVote = [];
        {% for choice in questions.choice_set.all|dictsortreversed:"id" %}
            dataVote.push({{ choice.votes }});
        {% endfor %}

        var dataGender = [];
        {% for gender in questions.gender_set.all|dictsortreversed:"id" %}
            dataGender.push({{ gender.num }});
        {% endfor %}

        var dataAge = [];
        {% for age in questions.age_set.all|dictsortreversed:"id" %}
            dataAge.push({{ age.option }});
        {% endfor %}

        var dataEducation = [];
        {% for education in questions.education_set.all|dictsortreversed:"id" %}
            dataEducation.push({{ education.number }});
        {% endfor %}

        var dataReligion = [];
        {% for religion in questions.religion_set.all|dictsortreversed:"id" %}
            dataReligion.push({{ religion.pick }});
        {% endfor %}

        var dataEthnicity = [];
        {% for ethnicity in questions.ethnicity_set.all|dictsortreversed:"id" %}
            dataEthnicity.push({{ ethnicity.racenum }});
        {% endfor %}

        var dataIncome = [];
        {% for income in questions.income_set.all|dictsortreversed:"id" %}
            dataIncome.push({{ income.amount }});
        {% endfor %}

        var percent_vote = [];
        var percent_gender = [];
        var percent_age = [];
        var percent_education = [];
        var percent_religion = [];
        var percent_ethnicity = [];
        var percent_income = [];
        var total_data = {{ view.kwargs.totalVotes }};

        for (i = 0; i < 2 ; i++){
            percent_gender.push((dataGender[i] / total_data) * 100);
        }

        for (i = 0; i < 2 ; i++){
            percent_vote.push((dataVote[i] / total_data) * 100);
        }

        for (i = 0; i < 6 ; i++){
            percent_age.push((dataAge[i] / total_data) * 100);
        }

        for (i = 0; i < 6 ; i++){
             percent_education.push((dataEducation[i] / total_data) * 100);
        }

        for (i = 0; i < 6 ; i++){
            percent_religion.push((dataReligion[i] / total_data) * 100).toFixed(1);
        }

        for (i = 0; i < 5 ; i++){
            percent_ethnicity.push((dataEthnicity[i] / total_data) * 100);
        }

        for (i = 0; i < 6 ; i++){
            percent_income.push((dataIncome[i] / total_data) * 100);
        }

        var cc = document.getElementById("choiceChart").getContext('2d');
        var choiceChart = new Chart(cc, {
            type: 'doughnut',
            data: {
                labels: ["I am for", "I am against"],
                datasets: [{
                    label: 'Percentage of Votes',
                    data: percent_vote,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

         var gc = document.getElementById("genderChart").getContext('2d');
         var genderChart = new Chart(gc, {
            type: 'doughnut',
            data: {
                labels: ["Male", "Female"],
                datasets: [{
                    label: 'Percentage of Votes',
                    data: percent_gender,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

        var ac = document.getElementById("ageChart").getContext('2d');
        var ageChart = new Chart(ac, {
            type: 'bar',
            data: {
                labels: ["18-24", "25-34", "35-44", "45-54", "55-64", "65 or older"],
                datasets: [{
                    label: 'Percentage of Votes',
                    data: percent_age,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });

        var ec = document.getElementById("educationChart").getContext('2d');
            var educationChart = new Chart(ec, {
                type: 'bar',
                data: {
                    labels: ["Junior Cert", "Leaving Cert", "PLC", "BA", "MA", "Doctorate"],
                    datasets: [{
                        label: 'Percentage of Votes',
                        data: percent_education,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });

            var rc = document.getElementById("religionChart").getContext('2d');
            var religionChart = new Chart(rc, {
                type: 'bar',
                data: {
                    labels: ["Christianity", "Islam", "Hinduism", "Buddhism", "Judaism","No Religion"],
                    datasets: [{
                        label: 'Percentage of Votes',
                        data: percent_religion,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });

            var etc = document.getElementById("ethnicityChart").getContext('2d');
            var ethnicityChart = new Chart(etc, {
                type: 'bar',
                data: {
                    labels: ["White", "Black", "Asian", "Hispanic", "Other"],
                    datasets: [{
                        label: 'Percentage of Votes',
                        data: percent_ethnicity,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });

            var ic = document.getElementById("incomeChart").getContext('2d');
            var incomeChart = new Chart(ic, {
                type: 'bar',
                data: {
                    labels: ["Social Welfare", "0-30k", "30k-50k","50k-75k", "75k-100k", "100k+"],
                    datasets: [{
                        label: 'Percentage  of Votes',
                        data: percent_income,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });
</script>
<br /><br />

<h3>Map!</h3>
<!-- initialising map-->
<div id="mapid">
{% leaflet_map "yourmap" callback="window.map_init_basic" %}
<style>
    #mapid{
      margin: auto;
      height: 10%;
      width: 60%;
      padding: 130px;
    }

    .leaflet-container {
        width: 900px;
        height: 600px;
    }
</style>
</div>
</body>
