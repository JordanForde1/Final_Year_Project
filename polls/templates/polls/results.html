<!-- Reference: https://docs.djangoproject.com/en/1.11/intro/ -->
<!-- Reference: https://www.w3schools.com/bootstrap/bootstrap_progressbars.asp -->
<!-- Reference: http://www.chartjs.org/docs/latest/ -->
<!-- Reference: https://www.patrick-wied.at/static/heatmapjs/ -->
<!-- Reference: http://leafletjs.com/examples/quick-start/ -->
<!-- Reference: https://www.google.com/recaptcha/intro/android.html -->
<!-- Reference: https://www.w3schools.com/w3css/w3css_animate.asp -->
<!-- Reference: https://webgradients.com/ -->

{% load mathfilters %}
{% load bootstrap3 %}

<head>
   <!-- all necessary links needed for various library -->
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
   <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
   <script src="https://rawgit.com/pa7/heatmap.js/master/build/heatmap.min.js"></script>
   <script src="https://rawgit.com/pa7/heatmap.js/master/plugins/leaflet-heatmap/leaflet-heatmap.js"></script>
</head>

<!-- heading of the page -->
<div class="container" id="title">
   <div class="row">
      <div class="page-header">
         <div class="w3-container w3-center w3-animate-opacity">
            <h1>{{ object.question_text }} RESULTS</h1>
         </div>
      </div>
   </div>
</div>
<hr />

<body>
   <!-- Showing data gathered by the poll as progress bars -->
   <div class="w3-animate-opacity">
      <h2>Progress bars of data gathered form the poll</h2>
      <hr />
      <div class="container" id="show">
         <select title="display" onChange="check(this)">
            <option value="YesNoOption"> Yes and no votes</option>
            <option value="MaleFemaleOption">Male and Female voters</option>
            <option value="AgesOption">Ages of voters</option>
            <option value="EducationOption">Education of voters</option>
            <option value="ReligionOption">Religion of voters</option>
            <option value="EthnicityOption">Ethnicity of voters</option>
            <option value="IncomeOption">Income of voters</option>
         </select>
      </div>

      <div class="container" id="YesNoDiv" style="display: block;">
         <h3> Yes and no votes</h3>
         <!--for loop to loop through database and order the output by id -->
         {% for choice in questions.choice_set.all|dictsortreversed:"id" %}
         <div class="progress">
            <!-- Creating the progress bar and telling it the % based on the votes -->
            <!-- Reference: https://stackoverflow.com/questions/33173943/django-reverse-using-kwargs?utm_medium=organic&utm_source=google_rich_qa&utm_campaign=google_rich_qa
               understanding how t get total votes from on page to another and use it correctly-->
            <div id="choice" class="progress-bar progress-bar-info" role="progressbar"  style="width:{{ choice.votes|div:view.kwargs.totalVotes|mul:"100"}}%">{{ choice.choice_text }} : {{ choice.votes|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
         </div>
      </div>
      {% endfor %}
      <br />
   </div>

   <div class="container" id="MaleFemaleDiv" style="display: none;">
      <h3> Male and Female voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for gender in questions.gender_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ gender.num|div:view.kwargs.totalVotes|mul:"100" }}%">{{ gender.gender_text }} : {{ gender.num|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <div class="container" id="AgesDiv" style="display: none;">
      <h3> Ages of voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for age in questions.age_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ age.option|div:view.kwargs.totalVotes|mul:"100" }}%">{{ age.age_text }} : {{ age.option|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <div class="container" id="EducationDiv" style="display: none;">
      <h3> Education of voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for education in questions.education_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ education.number|div:view.kwargs.totalVotes|mul:"100" }}%">{{ education.education_text }}: {{ education.number|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <div class="container" id="ReligionDiv" style="display: none;">
      <h3> Religion of voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for religion in questions.religion_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ religion.pick|div:view.kwargs.totalVotes|mul:"100" }}%">{{ religion.religion_text }}: {{ religion.pick|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <div class="container" id="EthnicityDiv" style="display: none;">
      <h3> Ethnicity of voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for ethnicity in questions.ethnicity_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ ethnicity.racenum|div:view.kwargs.totalVotes|mul:"100" }}%">{{ ethnicity.ethnicity_text }}: {{ ethnicity.racenum|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <div class="container" id="IncomeDiv" style="display: none;">
      <h3> Income of voters</h3>
      <!--for loop to loop through database and order the output by id -->
      {% for income in questions.income_set.all|dictsortreversed:"id" %}
      <div class="progress">
         <!-- Creating the progress bar and telling it the % based on the votes -->
         <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ income.amount|div:view.kwargs.totalVotes|mul:"100" }}%">{{ income.income_text }}: {{ income.amount|div:view.kwargs.totalVotes|mul:"100"|floatformat}}%
      </div>
   </div>
   {% endfor %}
   <br />
   </div>

   <br />

   <script>
      // Function called when an option is selected
      function check(select)
      {
          // Get the current option selected
          var option = select.value;

          // If it the YesNo option
          if(option === "YesNoOption")
          {
              // If the div is none
              if(document.getElementById("YesNoDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("YesNoDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the MaleFemale option
          if(option === "MaleFemaleOption")
          {
              // If the div is none
              if(document.getElementById("MaleFemaleDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("MaleFemaleDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the Ages option
          if(option === "AgesOption")
          {
              // If the div is none
              if(document.getElementById("AgesDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("AgesDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the Education option
          if(option === "EducationOption")
          {
              // If the div is none
              if(document.getElementById("EducationDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("EducationDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the Religion option
          if(option === "ReligionOption")
          {
              // If the div is none
              if(document.getElementById("ReligionDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("ReligionDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the Ethnicity option
          if(option === "EthnicityOption")
          {
              // If the div is none
              if(document.getElementById("EthnicityDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("EthnicityDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("IncomeDiv").style.display = "none";
              }
          }

          // If it the Income option
          if(option === "IncomeOption")
          {
              // If the div is none
              if(document.getElementById("IncomeDiv").style.display === "none")
              {
                  // Show it
                  document.getElementById("IncomeDiv").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDiv").style.display = "none";
                  document.getElementById("MaleFemaleDiv").style.display = "none";
                  document.getElementById("AgesDiv").style.display = "none";
                  document.getElementById("EducationDiv").style.display = "none";
                  document.getElementById("ReligionDiv").style.display = "none";
                  document.getElementById("EthnicityDiv").style.display = "none";
              }
          }
      }
   </script>
   <!-- Showing the data gathered by the poll in doughnut charts and bar charts -->
   <h2>Charts of data gathered form the poll</h2>
   <hr />

   <div class="container" id="show">
      <select title="displayGraphs" onChange="checkGraphs(this)">
         <option value="YesNoOptionChart"> Yes and no votes</option>
         <option value="MaleFemaleOptionChart">Male and Female voters</option>
         <option value="AgesOptionChart">Ages of voters</option>
         <option value="EducationOptionChart">Education of voters</option>
         <option value="ReligionOptionChart">Religion of voters</option>
         <option value="EthnicityOptionChart">Ethnicity of voters</option>
         <option value="IncomeOptionChart">Income of voters</option>
      </select>
   </div>

   <div class="container" id="YesNoDivChart" style="display: block;">
      <h3> Yes or no vote pie chart</h3>
      <div class="row">
         <canvas id="choiceChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="MaleFemaleDivChart" style="display: none;">
      <h3> Male and Female pie chart</h3>
      <div class="row">
         <canvas id="genderChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="AgesDivChart" style="display: none;">
      <h3> Age bar chart</h3>
      <div class="row">
         <canvas id="ageChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="EducationDivChart" style="display: none;">
      <h3> Education bar chart</h3>
      <div class="row">
         <canvas id="educationChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="ReligionDivChart" style="display: none;">
      <h3> Religion bar chart</h3>
      <div class="row">
         <canvas id="religionChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="EthnicityDivChart" style="display: none;">
      <h3> Ethnicity bar chart</h3>
      <div class="row">
         <canvas id="ethnicityChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>

   <div class="container" id="IncomeDivChart" style="display: none;">
      <h3> Income bar chart</h3>
      <div class="row">
         <canvas id="incomeChart" width="100" height="50"></canvas>
      </div>
      <br />
   </div>
   </div>

   <script>
      // Function called when an option is selected
      function checkGraphs(select)
      {
          // Get the current option selected
          var option = select.value;

          // If it the YesNo option
          if(option === "YesNoOptionChart")
          {
              // If the div is none
              if(document.getElementById("YesNoDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("YesNoDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the MaleFemale option
          if(option === "MaleFemaleOptionChart")
          {
              // If the div is none
              if(document.getElementById("MaleFemaleDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("MaleFemaleDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the Ages option
          if(option === "AgesOptionChart")
          {
              // If the div is none
              if(document.getElementById("AgesDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("AgesDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the Education option
          if(option === "EducationOptionChart")
          {
              // If the div is none
              if(document.getElementById("EducationDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("EducationDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the Religion option
          if(option === "ReligionOptionChart")
          {
              // If the div is none
              if(document.getElementById("ReligionDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("ReligionDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the Ethnicity option
          if(option === "EthnicityOptionChart")
          {
              // If the div is none
              if(document.getElementById("EthnicityDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("EthnicityDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("IncomeDivChart").style.display = "none";
              }
          }

          // If it the Income option
          if(option === "IncomeOptionChart")
          {
              // If the div is none
              if(document.getElementById("IncomeDivChart").style.display === "none")
              {
                  // Show it
                  document.getElementById("IncomeDivChart").style.display = "block";

                  // Hide the rest
                  document.getElementById("YesNoDivChart").style.display = "none";
                  document.getElementById("MaleFemaleDivChart").style.display = "none";
                  document.getElementById("AgesDivChart").style.display = "none";
                  document.getElementById("EducationDivChart").style.display = "none";
                  document.getElementById("ReligionDivChart").style.display = "none";
                  document.getElementById("EthnicityDivChart").style.display = "none";
              }
          }
      }
   </script>
   <script>
      //Getting the number of vote from the database for each questions asked
      var dataVote = [];
      {% for choice in questions.choice_set.all|dictsortreversed:"id" %}
          dataVote.push({{ choice.votes }});
      {% endfor %}

      var dataGender = [];
      {% for gender in questions.gender_set.all|dictsortreversed:"id" %}
          dataGender.push({{ gender.num }});
      {% endfor %}

      var dataAge = [];
      {% for age in questions.age_set.all|dictsortreversed:"id" %}
          dataAge.push({{ age.option }});
      {% endfor %}

      var dataEducation = [];
      {% for education in questions.education_set.all|dictsortreversed:"id" %}
          dataEducation.push({{ education.number }});
      {% endfor %}

      var dataReligion = [];
      {% for religion in questions.religion_set.all|dictsortreversed:"id" %}
          dataReligion.push({{ religion.pick }});
      {% endfor %}

      var dataEthnicity = [];
      {% for ethnicity in questions.ethnicity_set.all|dictsortreversed:"id" %}
          dataEthnicity.push({{ ethnicity.racenum }});
      {% endfor %}

      var dataIncome = [];
      {% for income in questions.income_set.all|dictsortreversed:"id" %}
          dataIncome.push({{ income.amount }});
      {% endfor %}

      //Arrays to get the total number of votes
      var percent_vote = [];
      var percent_gender = [];
      var percent_age = [];
      var percent_education = [];
      var percent_religion = [];
      var percent_ethnicity = [];
      var percent_income = [];
      var total_data = {{ view.kwargs.totalVotes }};

      //Total as %
      for (i = 0; i < 2 ; i++){
          percent_gender.push((dataGender[i] / total_data) * 100);
      }

      for (i = 0; i < 2 ; i++){
          percent_vote.push((dataVote[i] / total_data) * 100);
      }

      for (i = 0; i < 6 ; i++){
          percent_age.push((dataAge[i] / total_data) * 100);
      }

      for (i = 0; i < 6 ; i++){
           percent_education.push((dataEducation[i] / total_data) * 100);
      }

      for (i = 0; i < 6 ; i++){
          percent_religion.push((dataReligion[i] / total_data) * 100).toFixed(1);
      }

      for (i = 0; i < 5 ; i++){
          percent_ethnicity.push((dataEthnicity[i] / total_data) * 100);
      }

      for (i = 0; i < 6 ; i++){
          percent_income.push((dataIncome[i] / total_data) * 100);
      }

      //Creating the charts and adding the appropriate data
      var cc = document.getElementById("choiceChart").getContext('2d');
      var choiceChart = new Chart(cc, {
          type: 'doughnut',
          data: {
              labels: ["I am for", "I am against"],
              datasets: [{
                  label: 'Percentage of Votes',
                  data: percent_vote,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.8)',
                      'rgba(54, 162, 235, 0.8)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)'
                  ],
                  borderWidth: 1
              }]

          },
        options: {
              legend:{
                  labels:{
                      fontColor: '#ffffff'
                  }
              },

              scales: {
                  yAxes: [{
                      gridLines: {
                        color: 'rgba(255, 255, 255, 255)'
                      },
                      ticks: {
                          fontColor: '#ffffff',
                          beginAtZero:true
                      }
                  }],
                  xAxes:[{
                      gridLines: {
                        color: 'rgba(255, 255, 255, 255)'
                      },
                      ticks: {
                          fontColor: '#ffffff',
                          beginAtZero:true
                      }
                  }]
              }
          }
      });

       var gc = document.getElementById("genderChart").getContext('2d');
       var genderChart = new Chart(gc, {
          type: 'doughnut',
          data: {
              labels: ["Male", "Female"],
              datasets: [{
                  label: 'Percentage of Votes',
                  data: percent_gender,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.8)',
                      'rgba(54, 162, 235, 0.8)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)'
                  ],
                  borderWidth: 1
              }]
          },
            options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });

      var ac = document.getElementById("ageChart").getContext('2d');
      var ageChart = new Chart(ac, {
          type: 'bar',
          data: {
              labels: ["18-24", "25-34", "35-44", "45-54", "55-64", "65 or older"],
              datasets: [{
                  label: 'Percentage of Votes',
                  data: percent_age,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.8)',
                      'rgba(54, 162, 235, 0.8)',
                      'rgba(255, 206, 86, 0.8)',
                      'rgba(75, 192, 192, 0.8)',
                      'rgba(153, 102, 255, 0.8)',
                      'rgba(255, 159, 64, 0.8)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
          },
            options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });
      var ec = document.getElementById("educationChart").getContext('2d');
          var educationChart = new Chart(ec, {
              type: 'bar',
              data: {
                  labels: ["Junior Cert", "Leaving Cert", "PLC", "BA", "MA", "Doctorate"],
                  datasets: [{
                      label: 'Percentage of Votes',
                      data: percent_education,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });

          var rc = document.getElementById("religionChart").getContext('2d');
          var religionChart = new Chart(rc, {
              type: 'bar',
              data: {
                  labels: ["Christianity", "Islam", "Hinduism", "Buddhism", "Judaism","No Religion"],
                  datasets: [{
                      label: 'Percentage of Votes',
                      data: percent_religion,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });

          var etc = document.getElementById("ethnicityChart").getContext('2d');
          var ethnicityChart = new Chart(etc, {
              type: 'bar',
              data: {
                  labels: ["White", "Black", "Hispanic", "Asian", "Other"],
                  datasets: [{
                      label: 'Percentage of Votes',
                      data: percent_ethnicity,
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });

          var ic = document.getElementById("incomeChart").getContext('2d');
          var incomeChart = new Chart(ic, {
              type: 'bar',
              data: {
                  labels: ["Social Welfare", "0-30k", "30k-50k","50k-75k", "75k-100k", "100k+"],
                  datasets: [{
                      label: 'Percentage  of Votes',
                      data: percent_income,
                      backgroundColor: [
                          'rgba(255, 99, 132, .8)',
                          'rgba(54, 162, 235, 0.8)',
                          'rgba(255, 206, 86, 0.8)',
                          'rgba(75, 192, 192, 0.8)',
                          'rgba(153, 102, 255, 0.8)',
                          'rgba(255, 159, 64, 0.8)'
                      ],
                      borderColor: [
                          'rgba(255,99,132,1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
            options: {
                  legend:{
                      labels:{
                          fontColor: '#ffffff'
                      }
                  },

                  scales: {
                      yAxes: [{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }],
                      xAxes:[{
                          gridLines: {
                            color: 'rgba(255, 255, 255, 255)'
                          },
                          ticks: {
                              fontColor: '#ffffff',
                              beginAtZero:true
                          }
                      }]
                  }
              }
          });
   </script>
   <br /><br />

   <!-- Showing the data gathered by the poll in a heatmap -->
   <h2>Map of data gathered form the poll and gay marriage referendum</h2>
   <hr />

   <!-- Buttons to switch heatmaps from our poll and the gay marriage referendum poll -->
   <form>
      <div class="w3-container w3-center" id="maptext">
         <input type="radio" name="poll" value="Repeal" id="Repeal" class="big" onclick="checkmap(this.id)" checked> Repeal The 8th Poll&nbsp;
         <input type="radio" name="poll" value="Gay" id="Gay" class="big" onclick="checkmap(this.id)"> Gay Marriage Referendum&nbsp;
         <input type="radio" name="poll" value="Both" id="Both" class="big" onclick="checkmap(this.id)"> Overlay both maps&nbsp;
      </div>
   </form>
   <br />

   <!-- initialising map-->
   <div id="mapid" >
      <style>
         #mapid{
         margin: auto;
         height: 600px;
         width: 900px;
         padding: 130px;
         }
      </style>

      <script>
         //Arrays of points
         var points = [];
         var marriagePoints = [];

         //latitude of the center of the polygon for each constituency
         var lat = [
         -7.13146339548252,
         -7.04348955146049,
         -9.04479245707481,
         -8.26786531057318,
         -8.52939766954459,
         -8.9570970818183,
         -8.422810421735,
         -9.21624044318564,
         -7.89535104745885,
         -6.16182254747552,
         -6.24833540141698,
         -6.26178831233218,
         -6.23870976691181,
         -6.28320489357867,
         -6.23820872138959,
         -6.45903454709705,
         -6.32944385856961,
         -6.35685585892419,
         -6.38086452406351,
         -6.15001594279662,
         -8.63432405187148,
         -9.45728376643784,
         -9.72197227687176,
         -6.72776891887779,
         -6.85211420831545,
         -7.33535239032412,
         -8.79465665061881,
         -8.47952460969623,
         -7.59542750524393,
         -6.40443677791646,
         -9.39853766092637,
         -6.60450766391124,
         -6.96277441283594,
         -7.71820608895521,
         -8.28958966330417,
         -8.2244903240463,
         -7.93221640577651,
         -7.59710824971242,
         -6.57147738763868,
         -6.38944881256778
         ];

         //longitude of the center of the polygon for each constituency
         var long = [
         52.6096246434056,
         54.051557430385,
         52.8410045833781,
         52.0730703696247,
         51.9993830370912,
         52.0381735432769,
         51.8338783799749,
         51.6589304587245,
         54.9398981451611,
         53.383045166645,
         53.3256226236432,
         53.3573362579541,
         53.5154403858311,
         53.3899309617988,
         53.2552709820359,
         53.3050328126896,
         53.3300651298291,
         53.2558250359047,
         53.3948890380717,
         53.2554809055038,
         53.2855983362025,
         53.4272357153692,
         52.1193187636945,
         53.3270057030943,
         53.1177912528751,
         52.9898400211206,
         52.4726324864623,
         52.6407334575277,
         53.5937173474386,
         53.8885362844314,
         53.9471400084625,
         53.6577839315722,
         53.6047290734378,
         53.1617861543383,
         53.6714149906981,
         54.1581415278177,
         52.584703829407,
         52.1734310603601,
         52.4598905336528,
         52.9715892905177
         ];

         //votes for each constituency
         var gayMarriageTotalVotes =[
         53030,
         51784,
         41755,
         39894,
         43900,
         83794,
         52086,
         30592,
         29809,
         35479,
         42346,
         45117,
         39549,
         36736,
         58400,
         39820,
         39458,
         42162,
         36719,
         57787,
         27196,
         46894,
         59580,
         34123,
         34123,
         26789,
         29667,
         46599,
         41856,
         42508,
         54273,
         24692,
         24692,
         24573,
         29326,
         39704,
         67460,
         41224,
         49792,
         50017
         ];

         //Getting the number of people who have voted from each constituency
         var dataConstituency = [];
         {% for constituency in questions.constituency_set.all|dictsort:"id" %}
             dataConstituency.push({{ constituency.intensity }});
         {% endfor %}

         //Loop around number of constituencys to add data from our poll
         for (i =0; i < 40; i++){
             if(dataConstituency[i] > 0){
                 points.push({
                 "lat": long[i],
                 "lng": lat[i],
                 "count": dataConstituency[i]
             });
             }
         }

         //Loop around number of constituencys to add data from gay marriage referendum
         for (i =0; i < 40; i++){
             if(gayMarriageTotalVotes[i] > 0){
                 marriagePoints.push({
                 "lat": long[i],
                 "lng": lat[i],
                 "count": gayMarriageTotalVotes[i]
             });
             }
         }

         //Adding the data to the centroids
         var centroids = {
             length: 40,
             data: points
         };

         //Adding the data to the centroids
         var marriageCentroids = {
             length: 40,
             data: marriagePoints
         };

         //Base layer of the map
         var baseLayer = L.tileLayer(
           'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
             attribution: '...',
             maxZoom: 10,
             minZoom: 7,
             defaultZoom: 6
           }
         );

         //Configuration of the map
         var cfg = {
           "radius": .2,
           "maxOpacity": .5,
           "scaleRadius": true,
           "useLocalExtrema": true,
           latField: 'lat',
           lngField: 'lng',
           valueField: 'count'
         };

         //Heatmap layer
         var marriageheatmapLayer = new HeatmapOverlay(cfg);
         var heatmapLayer = new HeatmapOverlay(cfg);

         //Setting the map
         var map = new L.Map('mapid', {center: new L.LatLng(53.5424, -7.6921), zoom: 4, layers: [baseLayer,heatmapLayer,marriageheatmapLayer]});

         //Having our poll be displayed first
         heatmapLayer.setData(centroids);

         // Function called when a button is clicked
         function checkmap(id)
         {
             // If it the Repeal button
             	if(id === "Repeal") {
                     // If it is selected
                     if (document.getElementById(id).checked = true) {
                         //Remove any other layers and add our poll
                     	 marriageheatmapLayer.setData({data:[]});
                         heatmapLayer.setData(centroids);
                     }
                 }

                 // If it the Gay button
                 else if(id === "Gay")
                 {
                 	// If it is selected
                 	if(document.getElementById(id).checked = true) {
                 	     //Remove any other layers and add gay marriage referendum
                         heatmapLayer.setData({data:[]});
                         marriageheatmapLayer.setData(marriageCentroids);
                 	}
                 }

                 // If it the Both button
                 else if(id === "Both")
                 {
                 	// If it is selected
                 	if(document.getElementById(id).checked = true) {
                 	    //add both layers
                        marriageheatmapLayer.setData(marriageCentroids);
                 	    heatmapLayer.setData(centroids);
                 	}
                 }
         }
      </script>
   </div>
</body>

<style>
   @import 'https://fonts.googleapis.com/css?family=Open+Sans:300';

   form{
   color: #ffffff;
   }

   * {
   box-sizing: border-box;
   -webkit-box-sizing: border-box;
   margin: 0;
   padding: 0;
   }

   html, body {
   width: 100%;
   min-height: 100%;
   background-image: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%);
   position: relative;
   }

   h1, h2 {
   font-family: verdana, sans-serif;
   color: #ffffff;
   text-align: center;
   }

   h2 {
   font-weight: 400;
   }

   h1 {
   font-family: 'Open Sans', serif;
   font-weight: 300;
   text-transform: uppercase;
   font-size: 3.7em;
   }

   h2 {
   font-family: 'Open Sans', serif;
   font-weight: 300;
   color: #ffffff;
   font-size: 1.9em;
   }

   h3{
   font-family: 'Open Sans', serif;
   color: #fff;
   font-size: 1.9em;
   }

   .page-header {
   border: none;
   text-align: center;
   }

   .page-header h1 {
   margin-bottom: 6px;
   }

   .page-header h2 {
   margin-top: 0;
   }

   hr {
   height: 1px;
   border-top: 1px solid #ffffff;
   margin: 1em 0;
   margin-left: 475px;
   margin-right: 475px;
   }

   #maptext{
   font-family: 'Open Sans', serif;
   font-weight: 300;
   color: #ffffff;
   font-size: 1.5em;
   }

   .big{
   width: .8em;
   height: .8em;
   }

</style>