<!-- Reference:https://docs.djangoproject.com/en/1.11/intro/ -->
{% load leaflet_tags %}
{% load mathfilters %}
{% load bootstrap3 %}
<head>
    <!-- Map in center of the screen -->
    {% leaflet_js %}
    {% leaflet_css %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>
</head>

<h1>{{ questions.question_text }}</h1>
<h3>Progress bars!</h3>
<div class="container" id="container">
    <strong> Yes and no votes!</strong><br />
        {% for choice in questions.choice_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width:{{ choice.votes|div:view.kwargs.totalVotes|mul:"100"}}%">{{ choice.choice_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Male and Female voters!</strong>
        {% for gender in questions.gender_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ gender.num|div:view.kwargs.totalVotes|mul:"100" }}%">{{ gender.gender_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Ages of voters!</strong>
        {% for age in questions.age_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ age.option|div:view.kwargs.totalVotes|mul:"100" }}%">{{ age.age_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Education of voters!</strong>
        {% for education in questions.education_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ education.number|div:view.kwargs.totalVotes|mul:"100" }}%">{{ education.education_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Religion of voters!</strong>
        {% for religion in questions.religion_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ religion.pick|div:view.kwargs.totalVotes|mul:"100" }}%">{{ religion.religion_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Ethnicity of voters!</strong>
        {% for ethnicity in questions.ethnicity_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ ethnicity.racenum|div:view.kwargs.totalVotes|mul:"100" }}%">{{ ethnicity.ethnicity_text }}</div>
            </div>
        {% endfor %}
</div>

<br />

<div class="container" id="container">
    <strong> Income of voters!</strong>
        {% for income in questions.income_set.all %}
            <div class="progress">
                <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{ income.amount|div:view.kwargs.totalVotes|mul:"100" }}%">{{ income.income_text }}</div>
            </div>
        {% endfor %}
</div>
<br /><br />
<h3>Charts!</h3>
<strong> Income bar chart!</strong>
<canvas id="incomeChart" width="100" height="50"></canvas>
    <script>
            var dataIncome = [];
            {% for income in questions.income_set.all %}
                dataIncome.push({{ income.amount }});
            {% endfor %}

            var total_data = {{ view.kwargs.totalVotes }};
            var percent_data = [];

            for (i = 0; i < 6 ; i++){
                percent_data.push((dataIncome[i] / total_data) * 100);
            }

            var ctx = document.getElementById("incomeChart").getContext('2d');
            var incomeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["75,000-100,000", "50,000-75,000", "Social Welfare", "30,000-50,000", "100,00+", "0-30,000"],
                    datasets: [{
                        label: 'Percentage  of Votes',
                        data: percent_data,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255,99,132,1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero:true
                            }
                        }]
                    }
                }
            });
    </script>
<br /><br />

<!-- initialising map-->
<div id="mapid">
{% leaflet_map "yourmap" callback="window.map_init_basic" %}
<style>
    #mapid{
      margin: auto;
      height: 10%;
      width: 60%;
      padding: 10px;
    }

    .leaflet-container {
        width: 600px;
        height: 400px;
    }
</style>
</div>
</body>
